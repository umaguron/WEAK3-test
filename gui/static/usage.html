<!DOCTYPE html>
<html lang="ja">
<head>
    <title>usage</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>cmesh1</h1>
        <div class="row">
            <div class="col">
                <p>まずはじめに、各種実行ファイルや、インプットファイルの作成場所をsetting.iniに指定する必要がある。<a href="/setting.ini" download>ダウンロード</a></p>
                <p>setting.ini 各項目の説明は以下の通り。</p>
            </div>
        </div>    
        <br>
        <div class="row">
            <table class="table">
                <thead>
                    <tr>
                        <td><b>section</b></td>
                        <td></td>
                        <td><b>key</b></td>
                        <td></td>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <th rowspan="3">[toughexec]</th>
                        <td rowspan="3">TOUGHプログラムの置き場所</td>
                        <td><b>BIN_DIR</b></td>
                        <td>TOUGH3の各モジュールの実行ファイルが含まれるディレクトリ(フルパス)</td>
                    </tr>
                    <tr>
                        <td><b>BIN_DIR_T2</b></td>
                        <td>TOUGH2の各モジュールの実行ファイルが含まれるディレクトリ(フルパス)</td>
                    </tr>
                    <tr>
                        <td><b>BIN_DIR_LOCAL</b></td>
                        <td>上2つとは別にTOUGH3実行ファイルの場所を指定できる。WSに持っていく前に自分の端末でテストしたいときなどに便利。</td>
                    </tr>
                    <tr>
                        <th rowspan="8">[toughConfig]</th>
                        <td rowspan="8"></td>
                        <td><b>t2dataDir</b></td>
                        <td>シミュレーションごとのフォルダがこのディレクトリ配下に作成され、input/output fileが書き出される。</td>
                    </tr>
                    <tr>
                        <td colspan="2">その他の項目については、以下のようにする。</td>
                    </tr>
                    <tr><td>T3OUT_ESCAPE_DIRNAME</td><td>0t3out</td></tr>
                    <tr><td>SAVEFIG_DIRNAME</td><td>0fig</td></tr>
                    <tr><td>INCON_FILE_NAME</td><td>INCON</td></tr>
                    <tr><td>SAVE_FILE_NAME</td><td>SAVE</td></tr>
                    <tr><td>OUTPUT_ELEME_CSV_FILE_NAME</td><td>OUTPUT_ELEME.csv</td></tr>
                    <tr><td>OUTPUT_CONNE_CSV_FILE_NAME</td><td>OUTPUT_CONNE.csv</td></tr>
                    <tr>
                        <th rowspan="5">[ameshexec]</th>
                        <td rowspan="5">AMESH (Haukwa, 1998)実行ファイルの場所</td>
                        <td><b>AMESH_PROG</b></td>
                        <td>AMESH実行可能ファイルの名前</td>
                    </tr>
                    <tr>
                        <td><b>AMESH_DIR</b></td>
                        <td>AMESH_PROGがおいてあるディレクトリ（フルパス）/td>
                    </tr>
                    <tr>
                        <td colspan="2">その他の項目については、以下のようにする。</td>
                    </tr>
                    <tr><td>INPUT_FILENAME</td><td>in</td></tr>
                    <tr><td>SEGMT_FILENAME</td><td>segmt</td></tr>
                </tbody>
            </table>
        </div>
        <br>
        <div class="row">
            <div class="col">
                作成したsetting.iniをTOUGH3プロジェクト内の適当な場所に配置し、パスを<b>Path of setting config file</b>に入力し、<button class="btn btn-primary">check</button>を押下する。
            </div>
        </div>
        <div class="row">
            <div class="col">
                問題なければファイルの中身と<button class="btn btn-primary">go next</button>が表示される
            </div>
        </div>
        <br>
        <br>
        <br>
        <h1>cmesh2</h1>
        <br>
        <div class="row">
            <div class="col">
                <p>AMESH(Haukwa, 1998)を使用して、MULGRAPH (O'sullivan and Bullivant, 1995)形式のメッシュファイルを作成する。<p>
                <p>MULgraphについての詳しい説明はpyTOUGHマニュアルのappendix. Aを参照。</p>
            </div>
        </div>
        <br>
        <div class="row">
            <table class="table">
                <thead>
                    <tr>
                        <td></td>
                        <td></td>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Use existing mulgrid file</td>
                        <td>すでに作成済みのmulgraphファイルを読み込む。</td>
                    </tr>
                    <tr>
                        <td>Create new mulgrid file</td>
                        <td>mulgraphファイルを新規作成する。</td>
                    </tr>
                </tbody>
            </table>
            <table class="table">
                <thead>
                    <tr>
                        <td></td>
                        <td></td>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <th>Path of mulgrid file</th>
                        <td>既存 or これから作成するmulgraphファイルのパス</td>
                    </tr>
                    <tr>
                        <th>topodata_fp</th>
                        <td>
                            <p>地形データ。形式は以下の通り。xは北方向、yは東方向、zは標高。各数値の単位は[km]</p>   
                            <img src="/img/topodata.png">
                        </td>
                    </tr>
                    <tr>
                        <th>voronoi_seeds_list_fp</th>
                        <td>
                            <p><a href="https://ja.wikipedia.org/wiki/%E3%83%9C%E3%83%AD%E3%83%8E%E3%82%A4%E5%9B%B3">voronoiメッシュ</a>作成時に使用される、各セルの"seed"(母点)となる座標のリスト。形式は以下の通り。単位は[m]</p>   
                            <img src="/img/voro_sample.png">
                        </td>
                    </tr>
                    <tr>
                        <th>elevation_top_layer</th>
                        <td>メッシュ作成領域内の最高地点より高い標高[m]を書く。 </td>
                    </tr>
                    <tr>
                        <th>top_layer_min_thickness</th>
                        <td>最上位ブロックの厚さの最小値。地表面より上部のレイヤーを削ったり厚さを変更することでメッシュ上に地形が表現されるが、この値より薄くなることはない。 </td>
                    </tr>
                    <tr>
                        <th>tolar [m]</th>
                        <td>AMESHの設定値. the length of the minimum interface between elements.  </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <br>
        <div class="row">
            <div class="col">
                <button class="btn btn-primary">Create or check</button> を押下。
                問題なければ <button class="btn btn-primary">Go next</button> が表示される
            </div>
        </div>
        <br>
        <br>
        <br>
        <h1>cmesh3</h1>
        <br>
        <h4>General</h4>
        <div class="row">
            <table class="table">
                <thead>
                    <tr>
                        <td></td>
                        <td></td>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <th>problem name </th>
                        <td>この名前のフォルダがsetting.iniで指定したディレクトリ内部に作成され、各種ファイルが書き出される。すでにこの名前のフォルダが有る場合はエラーになる。</td>
                    </tr>
                    <tr>
                        <th>Resistivity structure data </th>
                        <td>
                            <p>以下の形式で作成された比抵抗構造データファイルのパスを指定する。</p>
                            <p>resは比抵抗[Ω], xはNorthing[m], yはEasting[m], zはdepth below sea level [m]</p>
                            <img src="/img/resdata.png">
                        </td>
                    </tr>
                    <tr>
                        <th>seedFlg </th>
                        <td>
                            今はまだうまく行かない（原因不明）。チェックを外しておく。
                        </td>
                    </tr>
                    <tr>
                        <th>boundary_side_permeable </th>
                        <td>側面に温度不変の透水境界を設定する。(仮想的に領域最外縁の要素に巨大な体積を与える。結果として、最外縁要素とその内側の要素は温度一定(初期条件から不変)の透水境界になる。)   </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <br>
        <br>
        <h4>Atmosphere block</h4>
        <div class="row">
            <div class="col">
                空気層の設定。use defaultを押下すると空欄に適当な値が設定される。
            </div>
        </div>
        <br>
        <br>
        <h4>Rocktype #XX</h4>
        <div class="row">
            <div class="col">
                porosityやpermeabilityの異なる複数の岩石タイプを設定可能。
                Rocktypeの数を増やしたいときは、gui/constants.pyのROCKTYPE_LENを増やす。
                use defaultを押下すると空欄に適当な値が設定される。
            </div>
        </div>
        <br>
        <br>
        <h5><b>各要素への割り当て方法</b></h5>  
        <br>
        <h6><b>1. 要素名で直接指定</b></h6>  
        <div class="row">
            <div class="col">
                blocklistにlist形式で要素名を指定。無条件でそのrocktypeが割り当てられる
            </div>
        </div>
        <br>
        <h6><b>2. 範囲+割り当て条件式による指定</b></h6>  
        <div class="row">
            <div class="col">
                rectangular region、かつrock_assign_conditionに指定された条件を満たす要素。
            </div>
        </div>
        <div style="color: red;">注意) ある要素について、複数の岩石タイプの割り当て条件に合致してしまう場合、番号が大きい岩石タイプが優先的に割り当てられる。
        </div>
        <br>
        <br>
        <h5>formula_porosity / formula_permeability </h5>
        <div class="row">
            <div class="col">
                <ul>
                    <li>formula_porosity, formula_permeabilityには、porosity, permeabilityの算出式を書くことができる。それぞれの式はeval関数で評価され、値が porosity, permに代入される。</li>
                    <li>seedFlgがtrueのとき、permは、rectangular regionとrock_assign_conditionを満たす要素の浸透率として、rocktypeの設定値を上書きする形で割り当てられる。ただし、TOUGH3での計算が不安定になるので現時点では実用的でない。原因調査中。</li>
                    <li>porosityはformula_permeabilityとrock_assign_condition, permはrock_assign_conditionの式に使用することができる。</li>
                    <li>使用しない場合はNoneを入力する。</li>
                </ul>
            </div>
        </div>
        <br>
        <h5> rock_assign_condition  </h5>
        <ul>
            <li>rocktypeを割り当てる条件式。</li>
            <li>rock_assign_conditionはpython3のeval関数で評価される。</li>
            <li>式がTrueと判定される要素にこのrocktypeが適用される</li>
        </ul>
        <div class="row">
            <table class="table">
            <thead>
                <tr>
                    <td>条件</td>
                    <td>rock_assign_condition</td>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>rectangular regionに含まれるすべての要素</td>
                    <td>True</td>
                </tr>
                <tr>
                    <td>地表から深さ500m以上の要素</td>
                    <td>depth > 500</td>
                </tr>
                <tr>
                    <td>標高0m以上かつ、座標中心から2km以内</td>
                    <td>z > 0 and (x**2 + y**2)**0.5 < 2000</td>
                </tr>
                <tr>
                    <td>比抵抗が5Ωm以下の要素</td>
                    <td>rho < 5</td>
                </tr>
            </tbody>
            </table>
        </div>
        <br>
        <div class="row">
            <div class="col">
                一番下の <button class="btn btn-primary">Check</button> を押下すると、tough3のメッシュのテスト作成を行う。エラーがなければcmesh4の画面に遷移する。
            </div>
        </div>
        <br>
        <br>
        <br>
        <h1>cmesh4</h1>
        <h1>cmesh5</h1>
    </div>
</body>
</html>
<!-- 
    <div class="row">
    <div class="col">
    </div>
</div>
<div class="row">
    <table class="table">
        <thead>
            <tr>
                <td><b>section</b></td>
                <td></td>
                <td><b>key</b></td>
                <td></td>
            </tr>
        </thead>
        <tbody>
            <tr></tr>
        </tbody>
    </table>
</div> 
-->